<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pocket PRC 3.0.1 - Keller Williams</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <style>
        body {
            -webkit-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        input[type="checkbox"],
        input[type="radio"] {
            min-width: 20px;
            min-height: 20px;
        }
        
        .action-button {
            min-height: 48px;
            min-width: 48px;
        }
        
        @media (max-width: 640px) {
            .mobile-text-sm {
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                <polyline points="7 3 7 8 15 8"></polyline>
            </svg>
        );

        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const FileText = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
        );

        const Mail = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
        );

        const Home = ({ size = 28 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const Share = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
        );

        const Camera = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>
        );

        const ImageIcon = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <polyline points="21 15 16 10 5 21"></polyline>
            </svg>
        );

        const Trash = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Edit = ({ size = 16 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );

        function PocketPRC() {
            const [formData, setFormData] = useState({
                propertyAddress: '',
                homesteadExemption: false,
                homesteadAmount: '',
                veteransExemption: false,
                veteransAmount: '',
                treeGrowthExemption: false,
                treeGrowthAmount: '',
                noExemptions: false,
                propertyDataCard: false,
                taxMap: false,
                dateVisited: '',
                currentZoning: '',
                floodZone: '',
                zoningOverlay: '',
                conformsToZoning: '',
                dwellingUnits: '',
                septicInShoreland: '',
                permitsDescription: '',
                codeEnforcementDocs: false,
                zoneOverlays: false,
                recordedSurvey: false,
                easements: false,
                associationDocs: false,
                associationFinancials: false,
                condoCertificate: false,
                septicDesign: false,
                completedBy: '',
                attachments: []
            });

            const [status, setStatus] = useState({ show: false, message: '', type: '' });
            const [generatedPdfBlob, setGeneratedPdfBlob] = useState(null);
            const [suggestedFilename, setSuggestedFilename] = useState('');
            const [renamingPhotoIndex, setRenamingPhotoIndex] = useState(null);

            // Generate suggested filename based on property address
            useEffect(() => {
                const propertyAddr = formData.propertyAddress || 'Property';
                const cleanAddr = propertyAddr.replace(/[^a-zA-Z0-9]/g, '_');
                const date = new Date().toISOString().split('T')[0];
                setSuggestedFilename(`PRC_${cleanAddr}_${date}.pdf`);
            }, [formData.propertyAddress]);

            const showStatus = (message, type) => {
                setStatus({ show: true, message, type });
                setTimeout(() => setStatus({ show: false, message: '', type: '' }), 4000);
            };

            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            // Auto-check when typing amounts
            const handleAmountChange = (field, amountField, value) => {
                setFormData(prev => ({
                    ...prev,
                    [amountField]: value,
                    [field]: value && parseFloat(value) > 0
                }));
            };

            const handleSave = () => {
                const dataStr = JSON.stringify(formData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                let filename = formData.propertyAddress 
                    ? formData.propertyAddress.replace(/[^a-z0-9]/gi, '_').toLowerCase() 
                    : 'prc_progress';
                filename = `${filename}_${new Date().toISOString().split('T')[0]}.json`;
                
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showStatus('✅ Progress saved!', 'success');
            };

            const handleLoad = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (!data.attachments) data.attachments = [];
                            setFormData(data);
                            showStatus('✅ Progress loaded!', 'success');
                        } catch (error) {
                            showStatus('❌ Error loading file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
                event.target.value = '';
            };

            const handleFileUpload = (event) => {
                const files = Array.from(event.target.files);
                let processed = 0;
                
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        setFormData(prev => ({
                            ...prev,
                            attachments: [...prev.attachments, {
                                name: file.name,
                                data: e.target.result,
                                type: file.type,
                                size: file.size
                            }]
                        }));
                        processed++;
                        if (processed === files.length) {
                            showStatus(`📎 Added ${files.length} file(s)`, 'success');
                        }
                    };
                    reader.readAsDataURL(file);
                });
            };

            const removeAttachment = (index) => {
                setFormData(prev => ({
                    ...prev,
                    attachments: prev.attachments.filter((_, i) => i !== index)
                }));
                showStatus('🗑️ File removed', 'success');
            };

            const renamePhoto = (index, newName) => {
                if (!newName || !newName.trim()) return;
                
                setFormData(prev => ({
                    ...prev,
                    attachments: prev.attachments.map((photo, i) => 
                        i === index ? { ...photo, name: newName.trim() } : photo
                    )
                }));
                setRenamingPhotoIndex(null);
                showStatus('✏️ File renamed', 'success');
            };

            // Helper function to correct image orientation
            const correctImageOrientation = async (dataUrl) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);
                        
                        resolve(canvas.toDataURL('image/jpeg', 0.92));
                    };
                    img.src = dataUrl;
                });
            };

            const generatePDF = async () => {
                try {
                    showStatus('📄 Generating PDF...', 'success');

                    const response = await fetch('KW_Maine_Public_Records_Checklist.pdf');
                    const pdfBytes = await response.arrayBuffer();
                    
                    const { PDFDocument, rgb, StandardFonts } = PDFLib;
                    const pdfDoc = await PDFDocument.load(pdfBytes);
                    const form = pdfDoc.getForm();

                    // Load font for photo labels
                    const helveticaBold = await pdfDoc.embedFont(StandardFonts.HelveticaBold);

                    // Helper functions
                    const setValue = (fieldName, value) => {
                        try {
                            const field = form.getTextField(fieldName);
                            if (value) field.setText(String(value));
                        } catch (e) { console.warn(`Field not found: ${fieldName}`); }
                    };

                    const setCheckbox = (fieldName, isChecked) => {
                        try {
                            const field = form.getCheckBox(fieldName);
                            isChecked ? field.check() : field.uncheck();
                        } catch (e) { console.warn(`Checkbox not found: ${fieldName}`); }
                    };

                    // Fill form fields
                    setValue('Property Address', formData.propertyAddress);
                    
                    setCheckbox('Homestead', formData.homesteadExemption);
                    setCheckbox('Veterans', formData.veteransExemption);
                    setCheckbox('Tree Growth', formData.treeGrowthExemption);
                    setCheckbox('NA', formData.noExemptions);
                    
                    setValue('Homestead $', formData.homesteadAmount);
                    setValue('Veterans $', formData.veteransAmount);
                    setValue('Tree Growth $', formData.treeGrowthAmount);
                    
                    setCheckbox('undefined', formData.propertyDataCard);
                    setCheckbox('undefined_2', formData.taxMap);
                    
                    // Date formatting
                    const dateValue = formData.dateVisited;
                    const formattedDate = dateValue ? new Date(dateValue + 'T00:00:00').toLocaleDateString('en-US') : '';
                    setValue('DATE VISITED', formattedDate);
                    
                    setValue('Current Zone', formData.currentZoning);
                    setValue('Overlay?', formData.zoningOverlay);
                    
                    if (formData.floodZone) {
                        try {
                            form.getRadioGroup('Flood Zone').select(formData.floodZone);
                        } catch (e) { console.warn('Flood Zone error'); }
                    }
                    
                    setValue('2 Does current use appear to conform to zoning restrictions', formData.conformsToZoning);
                    setValue('3 Number of legal dwelling units permitted per ordinance', formData.dwellingUnits);
                    
                    setCheckbox('undefined_3', formData.septicInShoreland === 'Yes');
                    setCheckbox('undefined_4', formData.septicInShoreland === 'No');
                    setCheckbox('undefined_5', formData.septicInShoreland === 'N/A');
                    
                    setValue('5 Record dates  descriptions of permits issued or code enforcement issues if any DO NOT LEAVE BLANK', 
                             formData.permitsDescription);
                    
                    setCheckbox('toggle_12', formData.codeEnforcementDocs);
                    setCheckbox('undefined_6', formData.zoneOverlays);
                    setCheckbox('undefined_7', formData.recordedSurvey);
                    setCheckbox('undefined_8', formData.easements);
                    setCheckbox('undefined_9', formData.associationDocs);
                    setCheckbox('undefined_10', formData.associationFinancials);
                    setCheckbox('undefined_11', formData.condoCertificate);
                    setCheckbox('undefined_12', formData.septicDesign);
                    
                    setValue('4 COMPLETED BY', formData.completedBy);

                    // Add attachments as pages with filenames
                    for (let i = 0; i < formData.attachments.length; i++) {
                        const attachment = formData.attachments[i];
                        try {
                            if (attachment.type.startsWith('image/')) {
                                const correctedDataUrl = await correctImageOrientation(attachment.data);
                                const base64Data = correctedDataUrl.split(',')[1];
                                const fileBytes = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));
                                
                                const image = await pdfDoc.embedJpg(fileBytes);
                                const page = pdfDoc.addPage();
                                const pageWidth = page.getWidth();
                                const pageHeight = page.getHeight();
                                const margin = 50;
                                
                                // Add photo title at top
                                page.drawText(`Attachment ${i + 1}: ${attachment.name}`, {
                                    x: margin,
                                    y: pageHeight - margin,
                                    size: 10,
                                    font: helveticaBold,
                                    color: rgb(0, 0, 0)
                                });
                                
                                // Calculate dimensions to fit image on page
                                const availableHeight = pageHeight - (2 * margin) - 30; // Space for title
                                const availableWidth = pageWidth - (2 * margin);
                                const imageAspect = image.width / image.height;
                                const pageAspect = availableWidth / availableHeight;
                                
                                let drawWidth, drawHeight;
                                if (imageAspect > pageAspect) {
                                    drawWidth = availableWidth;
                                    drawHeight = drawWidth / imageAspect;
                                } else {
                                    drawHeight = availableHeight;
                                    drawWidth = drawHeight * imageAspect;
                                }
                                
                                // Center the image
                                const x = (pageWidth - drawWidth) / 2;
                                const y = (pageHeight - drawHeight) / 2 - 15;
                                
                                page.drawImage(image, { x, y, width: drawWidth, height: drawHeight });
                            }
                            else if (attachment.type === 'application/pdf') {
                                const base64Data = attachment.data.split(',')[1];
                                const fileBytes = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));
                                const attachedPdf = await PDFDocument.load(fileBytes);
                                const copiedPages = await pdfDoc.copyPages(attachedPdf, attachedPdf.getPageIndices());
                                copiedPages.forEach(page => pdfDoc.addPage(page));
                            }
                        } catch (e) {
                            console.error('Error processing attachment:', attachment.name, e);
                        }
                    }

                    // Save PDF
                    const pdfBytesOutput = await pdfDoc.save();
                    const blob = new Blob([pdfBytesOutput], { type: 'application/pdf' });
                    
                    // Store the blob for email/share functionality
                    setGeneratedPdfBlob(blob);
                    
                    // Download the file
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = suggestedFilename;
                    link.click();
                    
                    const attachText = formData.attachments.length > 0 ? ` with ${formData.attachments.length} attachment(s)` : '';
                    showStatus(`✅ PDF generated${attachText}!`, 'success');
                    
                    return blob;
                } catch (error) {
                    console.error('Error:', error);
                    showStatus('❌ Error generating PDF', 'error');
                    return null;
                }
            };

            const handleEmail = () => {
                if (!generatedPdfBlob) {
                    showStatus('⚠️ Please generate PDF first', 'error');
                    return;
                }

                const subject = encodeURIComponent(`Public Records Checklist - ${formData.propertyAddress || 'Property'}`);
                const body = encodeURIComponent(
                    `Please find attached the Public Records Checklist.\n\n` +
                    `Property Address: ${formData.propertyAddress || 'N/A'}\n` +
                    `Completed By: ${formData.completedBy || 'N/A'}\n` +
                    `Date: ${new Date().toLocaleDateString()}\n\n` +
                    `Note: The PDF file has been downloaded to your device. Please attach it to this email.`
                );
                
                window.location.href = `mailto:?subject=${subject}&body=${body}`;
                showStatus('📧 Email client opened', 'success');
            };

            const handleShare = async () => {
                if (!generatedPdfBlob) {
                    showStatus('⚠️ Please generate PDF first', 'error');
                    return;
                }

                // Check if Web Share API is available
                if (navigator.share && navigator.canShare) {
                    try {
                        const file = new File([generatedPdfBlob], suggestedFilename, { type: 'application/pdf' });
                        
                        if (navigator.canShare({ files: [file] })) {
                            await navigator.share({
                                files: [file],
                                title: 'Public Records Checklist',
                                text: `Public Records Checklist for ${formData.propertyAddress || 'property'}`
                            });
                            showStatus('✅ Share completed!', 'success');
                        } else {
                            showStatus('⚠️ Sharing not supported on this device', 'error');
                        }
                    } catch (error) {
                        if (error.name !== 'AbortError') {
                            console.error('Share error:', error);
                            showStatus('❌ Error sharing file', 'error');
                        }
                    }
                } else {
                    showStatus('⚠️ Sharing not supported on this browser', 'error');
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <div className="bg-red-600 text-white p-4 shadow-lg sticky top-0 z-10">
                        <div className="max-w-2xl mx-auto">
                            <div className="flex items-center justify-between mb-3">
                                <div className="flex items-center gap-3">
                                    <Home size={28} />
                                    <div>
                                        <h1 className="text-xl font-bold">Pocket PRC</h1>
                                        <p className="text-xs opacity-75">v3.0.1</p>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Load and Save Buttons - Top */}
                            <div className="grid grid-cols-2 gap-2">
                                <button
                                    onClick={handleSave}
                                    className="action-button bg-white text-red-600 px-4 py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 hover:bg-gray-100 shadow-md transition-colors"
                                >
                                    <Save size={24} />
                                    Save Progress
                                </button>
                                
                                <label className="action-button bg-white text-red-600 px-4 py-3 rounded-lg font-bold text-base flex items-center justify-center gap-2 cursor-pointer hover:bg-gray-100 shadow-md transition-colors">
                                    <Upload size={24} />
                                    Load Progress
                                    <input type="file" accept=".json" onChange={handleLoad} className="hidden" />
                                </label>
                            </div>
                        </div>
                    </div>

                    {/* Status */}
                    {status.show && (
                        <div className={`max-w-2xl mx-auto mt-4 mx-4 p-4 rounded-lg text-base ${status.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                            {status.message}
                        </div>
                    )}

                    {/* Form */}
                    <div className="max-w-2xl mx-auto p-3 sm:p-4">
                        {/* Property Address */}
                        <div className="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
                            <label className="block font-semibold mb-2 text-sm sm:text-base">Property Address *</label>
                            <input
                                type="text"
                                value={formData.propertyAddress}
                                onChange={(e) => handleChange('propertyAddress', e.target.value)}
                                className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                placeholder="Enter property address"
                            />
                        </div>

                        {/* Section 1: Assessor's Office */}
                        <div className="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
                            <h2 className="text-base sm:text-lg font-bold mb-3 sm:mb-4 text-red-600">1. ASSESSOR'S OFFICE</h2>
                            
                            <div className="mb-4">
                                <p className="font-semibold mb-2 text-sm sm:text-base">Tax Exemptions</p>
                                <div className="space-y-2 sm:space-y-3">
                                    <label className="flex items-center gap-2 text-sm sm:text-base">
                                        <input
                                            type="checkbox"
                                            checked={formData.homesteadExemption}
                                            onChange={(e) => handleChange('homesteadExemption', e.target.checked)}
                                            className="w-5 h-5"
                                        />
                                        <span className="flex-shrink-0">Homestead $</span>
                                        <input
                                            type="number"
                                            value={formData.homesteadAmount}
                                            onChange={(e) => handleAmountChange('homesteadExemption', 'homesteadAmount', e.target.value)}
                                            className="flex-1 p-1 sm:p-2 border rounded text-sm sm:text-base"
                                            step="0.01"
                                            placeholder="Amount"
                                        />
                                    </label>
                                    <label className="flex items-center gap-2 text-sm sm:text-base">
                                        <input
                                            type="checkbox"
                                            checked={formData.veteransExemption}
                                            onChange={(e) => handleChange('veteransExemption', e.target.checked)}
                                            className="w-5 h-5"
                                        />
                                        <span className="flex-shrink-0">Veterans $</span>
                                        <input
                                            type="number"
                                            value={formData.veteransAmount}
                                            onChange={(e) => handleAmountChange('veteransExemption', 'veteransAmount', e.target.value)}
                                            className="flex-1 p-1 sm:p-2 border rounded text-sm sm:text-base"
                                            step="0.01"
                                            placeholder="Amount"
                                        />
                                    </label>
                                    <label className="flex items-center gap-2 text-sm sm:text-base">
                                        <input
                                            type="checkbox"
                                            checked={formData.treeGrowthExemption}
                                            onChange={(e) => handleChange('treeGrowthExemption', e.target.checked)}
                                            className="w-5 h-5"
                                        />
                                        <span className="flex-shrink-0">Tree Growth $</span>
                                        <input
                                            type="number"
                                            value={formData.treeGrowthAmount}
                                            onChange={(e) => handleAmountChange('treeGrowthExemption', 'treeGrowthAmount', e.target.value)}
                                            className="flex-1 p-1 sm:p-2 border rounded text-sm sm:text-base"
                                            step="0.01"
                                            placeholder="Amount"
                                        />
                                    </label>
                                    <label className="flex items-center gap-2 text-sm sm:text-base">
                                        <input
                                            type="checkbox"
                                            checked={formData.noExemptions}
                                            onChange={(e) => handleChange('noExemptions', e.target.checked)}
                                            className="w-5 h-5"
                                        />
                                        N/A
                                    </label>
                                </div>
                            </div>

                            <div className="space-y-2 text-sm sm:text-base">
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.propertyDataCard}
                                        onChange={(e) => handleChange('propertyDataCard', e.target.checked)}
                                        className="w-5 h-5"
                                    />
                                    ATTACH Property Data Card - required
                                </label>
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.taxMap}
                                        onChange={(e) => handleChange('taxMap', e.target.checked)}
                                        className="w-5 h-5"
                                    />
                                    ATTACH Tax Map - required
                                </label>
                            </div>
                        </div>

                        {/* Section 2: Code Enforcement */}
                        <div className="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
                            <h2 className="text-base sm:text-lg font-bold mb-3 sm:mb-4 text-red-600">2. CODE ENFORCEMENT OFFICE</h2>
                            
                            <div className="mb-4">
                                <label className="block font-semibold mb-2 text-sm sm:text-base">Date Visited</label>
                                <input
                                    type="date"
                                    value={formData.dateVisited}
                                    onChange={(e) => handleChange('dateVisited', e.target.value)}
                                    className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                />
                            </div>

                            <div className="grid grid-cols-1 gap-4 mb-4">
                                <div>
                                    <label className="block font-semibold mb-2 text-sm sm:text-base">Current Zoning</label>
                                    <input
                                        type="text"
                                        value={formData.currentZoning}
                                        onChange={(e) => handleChange('currentZoning', e.target.value)}
                                        className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                        placeholder="e.g., R-1, Commercial"
                                    />
                                </div>
                                <div>
                                    <label className="block font-semibold mb-2 text-sm sm:text-base">Zoning Overlay?</label>
                                    <input
                                        type="text"
                                        value={formData.zoningOverlay}
                                        onChange={(e) => handleChange('zoningOverlay', e.target.value)}
                                        className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                        placeholder="If applicable"
                                    />
                                </div>
                            </div>

                            <div className="mb-4">
                                <p className="font-semibold mb-2 text-sm sm:text-base">Flood Zone?</p>
                                <div className="flex gap-4 text-sm sm:text-base">
                                    <label className="flex items-center gap-2">
                                        <input
                                            type="radio"
                                            checked={formData.floodZone === 'Yes'}
                                            onChange={() => handleChange('floodZone', 'Yes')}
                                            className="w-5 h-5"
                                        />
                                        Yes
                                    </label>
                                    <label className="flex items-center gap-2">
                                        <input
                                            type="radio"
                                            checked={formData.floodZone === 'No'}
                                            onChange={() => handleChange('floodZone', 'No')}
                                            className="w-5 h-5"
                                        />
                                        No
                                    </label>
                                </div>
                            </div>

                            <div className="mb-4">
                                <label className="block font-semibold mb-2 text-sm sm:text-base">Does current use appear to conform to zoning restrictions?</label>
                                <input
                                    type="text"
                                    value={formData.conformsToZoning}
                                    onChange={(e) => handleChange('conformsToZoning', e.target.value)}
                                    className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                    placeholder="Yes/No and explanation"
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block font-semibold mb-2 text-sm sm:text-base">Number of legal dwelling units permitted per ordinance?</label>
                                <input
                                    type="text"
                                    value={formData.dwellingUnits}
                                    onChange={(e) => handleChange('dwellingUnits', e.target.value)}
                                    className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                    placeholder="e.g., 1, 2, etc."
                                />
                            </div>

                            <div className="mb-4">
                                <p className="font-semibold mb-2 text-sm sm:text-base">Septic system located in a shoreland zone?</p>
                                <div className="flex flex-wrap gap-3 sm:gap-4 text-sm sm:text-base">
                                    <label className="flex items-center gap-2">
                                        <input
                                            type="radio"
                                            checked={formData.septicInShoreland === 'Yes'}
                                            onChange={() => handleChange('septicInShoreland', 'Yes')}
                                            className="w-5 h-5"
                                        />
                                        Yes
                                    </label>
                                    <label className="flex items-center gap-2">
                                        <input
                                            type="radio"
                                            checked={formData.septicInShoreland === 'No'}
                                            onChange={() => handleChange('septicInShoreland', 'No')}
                                            className="w-5 h-5"
                                        />
                                        No
                                    </label>
                                    <label className="flex items-center gap-2">
                                        <input
                                            type="radio"
                                            checked={formData.septicInShoreland === 'N/A'}
                                            onChange={() => handleChange('septicInShoreland', 'N/A')}
                                            className="w-5 h-5"
                                        />
                                        N/A
                                    </label>
                                </div>
                            </div>

                            <div>
                                <label className="block font-semibold mb-2 text-sm sm:text-base">Record dates & descriptions of permits issued or code enforcement issues (DO NOT LEAVE BLANK)</label>
                                <textarea
                                    value={formData.permitsDescription}
                                    onChange={(e) => handleChange('permitsDescription', e.target.value)}
                                    className="w-full p-2 sm:p-3 border rounded h-32 text-sm sm:text-base"
                                    placeholder="Enter details or 'None'..."
                                />
                            </div>
                        </div>

                        {/* Section 3: Documents */}
                        <div className="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
                            <h2 className="text-base sm:text-lg font-bold mb-3 sm:mb-4 text-red-600">3. SUBMIT THE FOLLOWING DOCUMENTS</h2>
                            
                            <div className="space-y-2 mb-6 text-sm sm:text-base">
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.codeEnforcementDocs} onChange={(e) => handleChange('codeEnforcementDocs', e.target.checked)} className="w-5 h-5" />
                                    Pertinent code enforcement file documents
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.zoneOverlays} onChange={(e) => handleChange('zoneOverlays', e.target.checked)} className="w-5 h-5" />
                                    Zone Overlays
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.recordedSurvey} onChange={(e) => handleChange('recordedSurvey', e.target.checked)} className="w-5 h-5" />
                                    Recorded survey
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.easements} onChange={(e) => handleChange('easements', e.target.checked)} className="w-5 h-5" />
                                    Recorded easements, restrictions, covenants
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.associationDocs} onChange={(e) => handleChange('associationDocs', e.target.checked)} className="w-5 h-5" />
                                    Association declarations, bylaws, rules/regs
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.associationFinancials} onChange={(e) => handleChange('associationFinancials', e.target.checked)} className="w-5 h-5" />
                                    Association financial statements
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.condoCertificate} onChange={(e) => handleChange('condoCertificate', e.target.checked)} className="w-5 h-5" />
                                    Condominium resale certificate
                                </label>
                                <label className="flex items-center gap-2">
                                    <input type="checkbox" checked={formData.septicDesign} onChange={(e) => handleChange('septicDesign', e.target.checked)} className="w-5 h-5" />
                                    Septic Design (HHE 200)
                                </label>
                            </div>

                            {/* File Attachments with Camera/Choose options */}
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Add Photos/Documents
                                </label>
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    {/* Take Photo Button */}
                                    <label className="flex flex-col items-center justify-center gap-2 px-4 py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition-colors cursor-pointer">
                                        <Camera size={32} className="text-gray-400" />
                                        <span className="text-sm font-medium text-gray-700 text-center">
                                            Take Photo
                                        </span>
                                        <input
                                            type="file"
                                            multiple
                                            accept="image/*"
                                            capture="environment"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                        />
                                    </label>
                                    
                                    {/* Choose Files Button */}
                                    <label className="flex flex-col items-center justify-center gap-2 px-4 py-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-red-500 hover:bg-red-50 transition-colors cursor-pointer">
                                        <ImageIcon size={32} className="text-gray-400" />
                                        <span className="text-sm font-medium text-gray-700 text-center">
                                            Choose Files
                                        </span>
                                        <input
                                            type="file"
                                            multiple
                                            accept="image/*,.pdf"
                                            onChange={handleFileUpload}
                                            className="hidden"
                                        />
                                    </label>
                                </div>
                                <p className="text-xs text-gray-500 text-center mb-4">
                                    Files will be included in PDF with their names
                                </p>

                                {/* Attached Files Gallery */}
                                {formData.attachments.length > 0 && (
                                    <div className="space-y-4">
                                        <h3 className="font-semibold text-sm">Attached Files ({formData.attachments.length}):</h3>
                                        
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                            {formData.attachments.map((attachment, index) => (
                                                <div key={index} className="relative group">
                                                    {attachment.type.startsWith('image/') ? (
                                                        <img
                                                            src={attachment.data}
                                                            alt={attachment.name}
                                                            className="w-full h-40 object-cover rounded-lg border-2 border-gray-200"
                                                        />
                                                    ) : (
                                                        <div className="w-full h-40 flex items-center justify-center bg-gray-100 rounded-lg border-2 border-gray-200">
                                                            <FileText size={48} className="text-gray-400" />
                                                        </div>
                                                    )}
                                                    
                                                    <button
                                                        onClick={() => removeAttachment(index)}
                                                        className="absolute top-2 right-2 bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700"
                                                        title="Remove file"
                                                    >
                                                        <Trash size={16} />
                                                    </button>
                                                    
                                                    <button
                                                        onClick={() => setRenamingPhotoIndex(index)}
                                                        className="absolute top-2 right-14 bg-blue-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-700"
                                                        title="Rename file"
                                                    >
                                                        <Edit size={16} />
                                                    </button>
                                                    
                                                    <div className="absolute bottom-0 left-0 right-0 bg-black bg-opacity-60 text-white text-xs p-2 rounded-b-lg">
                                                        {renamingPhotoIndex === index ? (
                                                            <div className="flex gap-1">
                                                                <input
                                                                    type="text"
                                                                    defaultValue={attachment.name || 'Unknown'}
                                                                    onKeyDown={(e) => {
                                                                        if (e.key === 'Enter') {
                                                                            renamePhoto(index, e.target.value);
                                                                        } else if (e.key === 'Escape') {
                                                                            setRenamingPhotoIndex(null);
                                                                        }
                                                                    }}
                                                                    onBlur={(e) => renamePhoto(index, e.target.value)}
                                                                    autoFocus
                                                                    className="flex-1 px-2 py-1 text-black rounded text-xs"
                                                                    placeholder="Enter filename"
                                                                />
                                                            </div>
                                                        ) : (
                                                            <>
                                                                <p className="truncate">{attachment.name || 'Unknown'}</p>
                                                                <p className="text-gray-300">{((attachment.size || 0) / 1024).toFixed(1)} KB</p>
                                                            </>
                                                        )}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>

                                        <div className="bg-red-50 p-4 rounded-lg border border-red-200">
                                            <p className="text-sm text-red-800">
                                                <strong>{formData.attachments.length}</strong> file(s) will be included in your PDF with their names
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Section 4: Completed By */}
                        <div className="bg-white rounded-lg shadow p-3 sm:p-4 mb-3 sm:mb-4">
                            <h2 className="text-base sm:text-lg font-bold mb-3 sm:mb-4 text-red-600">4. COMPLETED BY</h2>
                            <input
                                type="text"
                                value={formData.completedBy}
                                onChange={(e) => handleChange('completedBy', e.target.value)}
                                className="w-full p-2 sm:p-3 border rounded text-sm sm:text-base"
                                placeholder="Your name"
                            />
                        </div>
                    </div>

                    {/* Generate, Email, and Share Buttons - Bottom */}
                    <div className="max-w-2xl mx-auto px-4 py-6">
                        <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                            <button
                                onClick={generatePDF}
                                className="action-button bg-yellow-400 text-gray-900 px-6 py-4 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-yellow-300 transition-colors shadow-lg"
                            >
                                <FileText size={24} />
                                <span>Generate PDF</span>
                            </button>

                            <button
                                onClick={handleEmail}
                                disabled={!generatedPdfBlob}
                                className="action-button bg-blue-600 text-white px-6 py-4 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-blue-700 transition-colors shadow-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                                title={!generatedPdfBlob ? "Generate PDF first" : "Open email with PDF"}
                            >
                                <Mail size={24} />
                                <span>Email PDF</span>
                            </button>

                            <button
                                onClick={handleShare}
                                disabled={!generatedPdfBlob}
                                className="action-button bg-green-600 text-white px-6 py-4 rounded-lg font-bold flex items-center justify-center gap-2 hover:bg-green-700 transition-colors shadow-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
                                title={!generatedPdfBlob ? "Generate PDF first" : "Share PDF"}
                            >
                                <Share size={24} />
                                <span>Share PDF</span>
                            </button>
                        </div>
                    </div>

                    {/* Footer */}
                    <div className="max-w-2xl mx-auto p-4 text-center text-sm text-gray-500">
                        <p>Pocket PRC v3.0.1 • Keller Williams Maine</p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PocketPRC />, document.getElementById('root'));
    </script>
</body>
</html>
